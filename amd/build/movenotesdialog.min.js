define("mod_board/movenotesdialog",["exports","core/modal_cancel","core/modal_events","core/notification","jquery","core/str"],(function(_exports,_modal_cancel,_modal_events,_notification,_jquery,Str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal_cancel=_interopRequireDefault(_modal_cancel),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_jquery=_interopRequireDefault(_jquery),Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);const getDestinationsList=moveNoteControl=>{const editableColumns=document.querySelectorAll('.board_column[data-locked="false"]'),wrapper=document.createElement("div"),movingNote=moveNoteControl.closest(".board_note"),movingNoteId=movingNote.dataset.ident,movingNoteColumn=movingNote.dataset.column;return editableColumns.forEach((column=>{const list=document.createElement("ul");list.classList.add("move-dialog-destinations","list-unstyled");const columnName=column.querySelector(".mod_board_column_name").innerText;Str.get_string("move_to_firstitemcolumn","mod_board",columnName).then((stringColumn=>{const li=document.createElement("li");li.classList.add("move-dialog-destination");const link=moveLink(column.dataset.ident,movingNoteId,0,movingNoteColumn,0,stringColumn);li.appendChild(link),list.appendChild(li);const destinations=column.querySelectorAll(".move_note");let count=0;return destinations.forEach((destination=>{count++;const li=document.createElement("li");li.classList.add("move-dialog-destination","ml-2");const targetNote=(0,_jquery.default)(destination.closest(".board_note"));let noteTitle=targetNote.find(".mod_board_note_heading").html();""===noteTitle&&(noteTitle=count);const sortOrder=targetNote.data("sortorder"),noteId=targetNote.data("ident");noteId!=movingNoteId&&Str.get_string("move_to_afterpost","mod_board",noteTitle).then((stringPost=>{const link=moveLink(column.dataset.ident,movingNoteId,noteId,movingNoteColumn,sortOrder+1,stringPost);return li.appendChild(link),list.appendChild(li),""})).catch(_notification.default.exception)})),wrapper.appendChild(list),""})).catch(_notification.default.exception)})),wrapper},moveLink=(columnId,movingNoteId,targetNoteId,movingNoteColumn,sortOrder,linkString)=>{const link=document.createElement("a");return link.setAttribute("href","#"),link.dataset.columnid=columnId,link.dataset.movingnoteid=movingNoteId,link.dataset.targetnoteid=targetNoteId,link.dataset.movingnotecolumn=movingNoteColumn,link.dataset.sortorder=sortOrder,link.innerText=linkString,link},displayMoveModal=moveNoteControl=>{const modalTitle=moveNoteControl.getAttribute("aria-label");_modal_cancel.default.create({title:modalTitle,body:getDestinationsList(moveNoteControl)}).then((modal=>(modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),document.addEventListener("closemovedialog",(()=>{modal.destroy()})),modal.show(),modal))).catch(_notification.default.exception)};var _default={init:(ownerId,moveNote)=>{const body=document.querySelector("body");body.classList.contains("move-dialog-initialized")||(document.addEventListener("click",(e=>{const moveNoteControl=e.target.closest(".mod_board_note_controls .move_note");moveNoteControl&&displayMoveModal(moveNoteControl);const moveDestination=e.target.closest(".move-dialog-destination a");if(moveDestination){e.preventDefault();let payload={id:parseInt(moveDestination.dataset.movingnoteid),columnid:parseInt(moveDestination.dataset.columnid),ownerid:ownerId,sortorder:parseInt(moveDestination.dataset.sortorder)};const movingNoteColumn=parseInt(moveDestination.dataset.movingnotecolumn),movingNote=document.querySelector('.board_note[data-ident="'.concat(moveDestination.dataset.movingnoteid,'"]')),toColumn=document.querySelector('.board_column[data-ident="'.concat(moveDestination.dataset.columnid,'"] .board_column_content'));if(0==moveDestination.dataset.sortorder)toColumn.prepend(movingNote);else{const targetNote=document.querySelector('.board_note[data-ident="'.concat(moveDestination.dataset.targetnoteid,'"]'));targetNote?toColumn.insertBefore(movingNote,targetNote.nextSibling):toColumn.appendChild(movingNote)}moveNote(movingNoteColumn,payload,!1),document.dispatchEvent(new Event("closemovedialog"))}})),document.addEventListener("keypress",(e=>{const moveNoteControl=e.target.closest(".mod_board_note_controls .move_note");moveNoteControl&&displayMoveModal(moveNoteControl)})),body.classList.add("move-dialog-initialized"))}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=movenotesdialog.min.js.map